#!/usr/bin/make -f
export DH_VERBOSE = 1

export DEB_BUILD_MAINT_OPTIONS = "nostrip"
export DEB_BUILD_OPTIONS =  "nostrip"

DPKG_EXPORT_BUILDFLAGS = 1

include /usr/share/dpkg/buildflags.mk

%:
	dh $@

override_dh_auto_clean:
	make clean
	eval ./debian/libbpf.sh clean

override_dh_auto_configure:
	eval ./debian/libbpf.sh ubuntu
	dh_auto_configure $@

override_dh_auto_install:
	mkdir -p debian/conntracker/usr/sbin
	cp conntracker debian/conntracker/usr/sbin/conntracker
	mkdir -p debian/conntracker-btf/var/lib/conntracker/
	cp ebpf/btf/ubuntu-bionic.btf debian/conntracker-btf/var/lib/conntracker/ubuntu.btf
	mkdir -p debian/conntracker-btf-hwe/var/lib/conntracker/
	cp ebpf/btf/ubuntu-bionic-hwe.btf debian/conntracker-btf-hwe/var/lib/conntracker/ubuntu.btf
	dh_auto_build $@

override_dh_installman:
	dh_installman -p conntracker conntracker.1
	dh_installman $@
